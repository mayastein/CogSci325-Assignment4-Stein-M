---
title: "Assignment 4"
author: "Maya Stein"
output:
  pdf_document:
    latex_engine: xelatex
    fig_width: 5
    fig_height: 3
geometry: margin = 0.1in
header-includes:
  - \usepackage{floatrow}
  - \floatsetup[figure]{capposition=side}
---

```{r load_the_libraries, echo=FALSE, results=FALSE, message=FALSE}
library(tidyverse)
library(dplyr)
library(psymetadata)
```

```{r view_the_data, echo=FALSE, results=FALSE, message=FALSE}
barroso2021
```


```{r math_ability_per_grade, echo=FALSE, results=FALSE, message=FALSE}
#First I will explore the number of students with low vs high math ability per each grade
barroso2021 |> 
  group_by(grade) |> 
  count(low_ability)
```


```{r assess_grades_1_3_4_5, echo=FALSE, results=FALSE, message=FALSE}
#It seems there are no students identified as having low math ability in grades 1, 3, 4, and 6. Now I will confirm if this is accurate
barroso2021 |> 
  filter(grade==1 | grade==3 | grade==4 | grade==6) |> 
  distinct(low_ability)
```

```{r assess_grades_2_5, echo=FALSE, results=FALSE, message=FALSE}
barroso2021 |> 
  filter(grade==2 | grade==5) |> 
  distinct(low_ability)
```

- For this assignment, I will be analyzing data from the barroso2021 data set. This data set is from the psymetadata package, and it observes the relationship between math achievement and math anxiety (https://psycnet.apa.org/record/2020-80018-001). Participants are in grades 1 through 6, and math ability is characterized as either low or not low. Grade 5 has a significantly larger sample size than the other grades, which will likely impact effect size measurements. Note: only grades 2 and 5 have students in the low math ability condition.

- The focus of this analysis will be analyzing differences in effect size across different parameters,  where the absolute value was calculated, so values range from 0 (no effect) to 1 (strongest possible effect)



```{r sample_size_per_grade, echo=FALSE, results=FALSE, message=FALSE}
# I now need to observe the sample size for each grade
barroso2021 |> 
  group_by(grade) |> 
  summarize(n=n())
```

```{r effect_size_groupings, echo=FALSE, results=FALSE, message=FALSE}
#Now I am going to group effect sizes based on the magnitude of their absolute value
data_by_yi <- barroso2021 |> 
  mutate(
    abs_yi = abs(yi),
    magnitude_yi = case_when(
      abs_yi < 0.2 ~ "No Effect",
      abs_yi >= 0.2 & abs_yi < 0.5 ~ "Small Effect",
      abs_yi >= 0.5 & abs_yi < 0.8 ~ "Medium Effect",
      abs_yi >= 0.8 ~ "Large Effect"
    )
  )
```

```{r effect_size_distribution, echo=FALSE, results=FALSE, message=FALSE}
# Now I will observe the distribution of effect sizes
data_by_yi_sorted <- data_by_yi |> 
  mutate(magnitude_yi=fct_reorder(magnitude_yi, abs_yi))
```

```{r effect_size_distribution_visualization, echo=FALSE, results=FALSE, message=FALSE}
effect_size_vis <- data_by_yi_sorted |> 
  ggplot(aes(x=magnitude_yi)) +
  geom_bar(fill="#E5D6FF") +
  labs(
    x = "Effect Size",
    y = "Count",
    title = "Range of Effect Sizes"
  ) +
  theme_dark()
```


```{r sample_size_distribution, echo=FALSE, results=FALSE, message=FALSE}
#Rename the low_ability values
data_by_yi_sorted <- data_by_yi_sorted |> 
  mutate(math_ability = case_when(
    low_ability == 1 ~ "Low_Math_Ability",
    low_ability == 2 ~ "Avg_Plus_Math_Ability"
  ))
```


```{r sample_size_distribution_visualization, echo=FALSE, results=FALSE, message=FALSE}
#create the sample size graph
sample_size_visualization <- data_by_yi_sorted |>
  group_by(grade, low_ability) |> 
  ggplot(mapping=aes(x=grade, fill=math_ability)) +
  geom_bar(position="dodge") +
  labs(
    title = "Distribution of Sample Sizes Per Grade and Math Ability Level",
    x = "Count",
    y = "Grade",
    fill = "Math Ability"
  ) +
  theme_dark()
```

```{r show_sample_size_visualization, echo=FALSE, results=FALSE, message=FALSE}
#Change colors and save the graph
visualization1 <- sample_size_visualization + scale_fill_manual(values = c("Avg_Plus_Math_Ability" = "#78FFEC", "Low_Math_Ability" = "#FF99EA"))
```

```{r effect_size_distribution_grades_visualization, echo=FALSE, results=FALSE, message=FALSE}
#Create and save the effect size per grade graph
visualization2 <- data_by_yi_sorted |> 
  group_by(grade, magnitude_yi) |> 
  summarize(mean_yi = mean(abs_yi), count_yi=n()) |> 
  ggplot(aes(x=count_yi, y=magnitude_yi))+
  geom_col(fill="#E5D6FF") +
  facet_wrap(~grade) +
  labs(
    title = "Effect Size Distributions",
    subtitle = "For Each Grade (1 - 6)",
    x = "Count",
    y = "Effect Size"
  ) +
  theme_dark()
```
```{r fig.cap=" difference in effect size distribution for each grade. The majority of studies for grades 1, 3, 4, and 6 had small effect sizes. The majority of effect sizes for grades 2 and 5 were split between no effect and small effect. A small proportion of each grade had a medium effect size, but large effect sizes were rarely observed.", echo=FALSE}
visualization2
```

```{r effect_size_distribution_grades_ability__visualization, echo=FALSE, results=FALSE, message=FALSE}
#Create and save the graph for low vs high math level effect sizes in grades 2 and 5
effect_size_visualization <- data_by_yi_sorted |>
  filter(grade==2 | grade == 5) |> 
  group_by(grade, magnitude_yi, math_ability) |> 
  summarize(mean_yi = mean(abs_yi), count_yi=n()) |> 
  ggplot(aes(x=count_yi, y=magnitude_yi, fill=math_ability))+
  geom_col(position="dodge") +
  facet_wrap(~grade) +
  labs(
    title = "Effect Size Distributions",
    subtitle = "For low vs average math abilities, grades 2 and 6",
    x = "Count",
    y = "Effect Size",
    fill = "Math Ability"
  ) +
  theme_dark()
```

```{r show_effect_size_distribution_grades_visualization, echo=FALSE, results=FALSE, message=FALSE}
#Change colors and save the graph
visualization3 <- effect_size_visualization + scale_fill_manual(values = c("Avg_Plus_Math_Ability" = "#78FFEC", "Low_Math_Ability" = "#FF99EA"))
```
```{r fig.cap="Most scores in the low math ability category had no effect, though grade 2 had a meaningful number of scores in the small and medium effect categories. However, more data in the low math ability category is needed to better understand the effect size distribution.", echo=FALSE}
visualization3
```
As demonstrated by figure 2, most scores in the low math ability category had no effect, though grade 2 had a meaningful number of scores in the small and medium effect categories. However, more data in the low math ability category is needed to better understand the effect size distribution.

# Conclusion
There is a significantly smaller effect size for low math ability participants compared to average-above average students. This is likely impacted by the small sample sizes in these conditions. There is a less obvious (but still important) difference in effect sizes for each grade. Grade 5 has the highest number of scores for each effect size condition except "large effect". This is likely due to its significantly higher sample size than that of the other grades.
