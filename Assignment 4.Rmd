---
title: "Assignment 4"
output: html_notebook
author: "Maya Stein"
date: "`r Sys.Date()`"
---

# Set Up

Load the libraries
```{r}
library(tidyverse)
library(dplyr)
library(psymetadata)
```
Look at the data set
```{r}
?barroso2021
```
```{r}
barroso2021
```

First I will explore the number of students with low vs high math ability per each grade
```{r}
barroso2021 |> 
  group_by(grade) |> 
  count(low_ability)
```

It seems there are no students identified as having low math ability in grades 1, 3, 4, and 6. Now I will confirm if this is accurate

Assess grades 1, 3, 4, and 5
```{r}
barroso2021 |> 
  filter(grade==1 | grade==3 | grade==4 | grade==6) |> 
  distinct(low_ability)
```

Assess grades 2 and 5
```{r}
barroso2021 |> 
  filter(grade==2 | grade==5) |> 
  distinct(low_ability)
```

I now need to observe the sample size for each grade
```{r}
barroso2021 |> 
  group_by(grade) |> 
  summarize(n=n())
```
Grade 5 has the biggest sample, as well as students for both high and low math ability conditions. Grade 6 has the lowest sample size, which likely explains the lack of samples for students with low math abilities. The absence/presence of low math ability students in the other grades is not well understood at this time. This will likely play a role in observations of effect size.

I will now look at the range of effect sizes (absolute values of effect size)
No effect = > 0.0,  < 0.2
Small effect  = >= 0.2, < 0.5
Medium effect = >=0.5, <0.8
Large effect = >0.8
```{r}
barroso2021 |> 
  group_by(yi) |>
  ggplot(aes(x=abs(yi))) +
  geom_bar()
```

Now I am going to group effect sizes based on the magnitude of their absolute value
```{r}
data_by_yi <- barroso2021 |> 
  mutate(
    abs_yi = abs(yi),
    magnitude_yi = case_when(
      abs_yi < 0.2 ~ "No Effect",
      abs_yi >= 0.2 & abs_yi < 0.5 ~ "Small Effect",
      abs_yi >= 0.5 & abs_yi < 0.8 ~ "Medium Effect",
      abs_yi >= 0.8 ~ "Large Effect"
    )
  )
```

Now I will observe the distribution of effect sizes
```{r}
data_by_yi_sorted <- data_by_yi |> 
  mutate(magnitude_yi=fct_reorder(magnitude_yi, abs_yi))
```

```{r}
data_by_yi_sorted |> 
  ggplot(aes(x=magnitude_yi)) +
  geom_bar()
```

# Visualizations

Sample size for low/high math ability distributed by grade
```{r}
data_by_yi_sorted |> 
  group_by(grade, low_ability) |> 
  ggplot(mapping=aes(x=grade, fill=low_ability)) +
  geom_bar(position="dodge")
```

Effect size distributed by grade
```{r}
data_by_yi_sorted |> 
  group_by(grade, magnitude_yi) |> 
  summarize(mean_yi = mean(abs_yi), count_yi=n()) |> 
  ggplot(aes(x=count_yi, y=magnitude_yi))+
  geom_col() +
  facet_wrap(~grade)
```

Effect size distributed by grade - low vs high math ability for grades 2 and 5
```{r}
data_by_yi_sorted |>
  filter(grade==2 | grade == 5) |> 
  group_by(grade, magnitude_yi, low_ability) |> 
  summarize(mean_yi = mean(abs_yi), count_yi=n()) |> 
  ggplot(aes(x=count_yi, y=magnitude_yi, fill=low_ability))+
  geom_col(position="dodge") +
  facet_wrap(~grade)
```